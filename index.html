<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WalkNav v5</title>
  <style>
:root{
  --glass: rgba(20,28,44,.7);
  --glass-strong: rgba(16,22,36,.85);
  --stroke: rgba(255,255,255,.14);
  --text: #eaf2ff;
  --muted:#a7b8ce;
  --primary:#5fb1ff;
  --ok:#25d07a;
  --danger:#ff6565;
  --accent:#64d2ff;
}
html,body{height:100%;margin:0;background:#0a1321;color:var(--text);font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif}
*{box-sizing:border-box}
.app{position:relative;height:100dvh;overflow:hidden}
#map{position:absolute;inset:0;display:none}
.control-panel{
  position:absolute;
  right:10px;
  top:20%;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:100;
}
button.ctrl{
  width:80px;
  height:60px;
  border:none;
  border-radius:18px;
  color:var(--text);
  font-weight:600;
  background:var(--glass);
  backdrop-filter:blur(10px);
  box-shadow:0 0 0 1px var(--stroke);
}
button.ctrl:active{background:var(--glass-strong)}
.info-panel{
  position:absolute;
  top:10px;
  left:10px;
  right:10px;
  background:var(--glass);
  border-radius:16px;
  padding:10px;
  box-shadow:0 0 0 1px var(--stroke);
  backdrop-filter:blur(8px);
  z-index:50;
}
.loading{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:#0a1321;
  z-index:200;
}
.loading p{margin:6px 0;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <div id="map"></div>

    <div class="info-panel">
      <h2>目的地を設定してください</h2>
      <p>半径5km圏内の情報を表示しています。</p>
      <div id="status"></div>
    </div>

    <div class="control-panel">
      <button class="ctrl" id="btn-locate">現在地</button>
      <button class="ctrl" id="btn-search">検索</button>
      <button class="ctrl" id="btn-stop">案内停止</button>
      <button class="ctrl" id="btn-dest">目的地</button>
      <button class="ctrl" id="btn-reroute">リルート</button>
      <button class="ctrl" id="btn-mode">操作</button>
    </div>

    <div class="loading" id="loading">
      <p>現在地取得中...</p>
      <p>もうしばらくお待ちください。</p>
    </div>
  </div>

  <script>
let map, marker, watchId;
let initialized = false;

async function initWalkNav(){
  const { Map } = await google.maps.importLibrary("maps");
  const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");

  if(!navigator.geolocation){
    alert("この端末では位置情報が利用できません。");
    document.getElementById("loading").style.display="none";
    return;
  }

  navigator.geolocation.getCurrentPosition(async pos=>{
    const center={lat:pos.coords.latitude,lng:pos.coords.longitude};
    map=new Map(document.getElementById("map"),{
      center,
      zoom:15,
      mapId:"walknav-map"
    });
    marker=new AdvancedMarkerElement({
      map,
      position:center,
      title:"現在地"
    });
    document.getElementById("map").style.display="block";
    document.getElementById("loading").style.display="none";
    initialized=true;
  },err=>{
    alert("Location error: "+err.message);
    document.getElementById("loading").style.display="none";
  });
}

document.getElementById("btn-locate").addEventListener("click",()=>{
  if(!initialized)return;
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const c={lat:pos.coords.latitude,lng:pos.coords.longitude};
      map.setCenter(c);
      marker.position=c;
    });
  }
});

window.addEventListener("load",initWalkNav);
  </script>

  <!-- new async loader (no callback / no duplicate) -->
  <script
    async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzojEE2142O8dWPd7gmcAj-FyWumYyFy4&loading=async&libraries=maps,marker,places&language=ja&v=beta">
  </script>
</body>
</html>