<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WalkNav v5</title>
  <style>
    /* 元のスタイルそのまま、修正点のみ追加 */
    :root{
      --glass: rgba(20,28,44,.7);
      --glass-strong: rgba(16,22,36,.85);
      --stroke: rgba(255,255,255,.14);
      --text: #eaf2ff;
      --muted:#a7b8ce;
      --primary:#5fb1ff;
      --ok:#25d07a;
      --danger:#ff6565;
      --accent:#64d2ff;
    }
    html,body{height:100%;margin:0;background:#0a1321;color:var(--text);font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif}
    *{box-sizing:border-box}
    .app{position:relative;height:100dvh;overflow:hidden}
    #map{position:absolute;inset:0;display:none}

    .control-panel{
      position:absolute;
      left:10px;
      right:10px;
      bottom:0;
      z-index:500;
      background:var(--glass);
      border:1px solid var(--stroke);
      border-radius:16px 16px 0 0;
      backdrop-filter:blur(14px);
      padding:16px;
      transition:transform 0.3s;
    }
    .control-panel.hidden{transform:translateY(100%)}
    .panel-toggle{
      position:fixed;
      bottom:10px;
      left:50%;
      transform:translateX(-50%);
      background:var(--accent);
      border:none;
      border-radius:12px;
      padding:14px 40px;
      color:#000;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      z-index:490;
      display:none !important;
      box-shadow:0 4px 12px rgba(0,0,0,.3);
    }
    .panel-toggle.show{display:block !important;} /* 修正: !importantを追加して優先度を上げる */
    .panel-row{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
    .panel-btn{
      flex:1;
      min-width:120px;
      background:var(--glass-strong);
      border:1px solid var(--stroke);
      border-radius:10px;
      padding:10px;
      color:#fff;
      font-size:14px;
      text-align:center;
      cursor:pointer;
      font-weight:700;
    }
    .panel-btn.primary{background:var(--primary);border:none;color:#000}
    .panel-btn.recording{background:var(--danger);border:none;color:#fff}
    .panel-btn.danger{background:var(--danger);border:none;color:#fff}
    input,select{
      width:100%;
      background:var(--glass-strong);
      border:1px solid var(--stroke);
      color:var(--text);
      border-radius:10px;
      padding:10px;
      font-size:14px;
    }

    .info-panel{
      position:absolute;
      left:10px;
      right:10px;
      top:10px;
      background:var(--glass);
      border:1px solid var(--stroke);
      border-radius:12px;
      backdrop-filter:blur(14px);
      padding:14px 14px 18px 14px;
      z-index:460;
      color:var(--text);
      display:none;
      pointer-events:none;
    }
    .info-panel.show{display:block !important}
    .route-main{
      font-size:27px;
      font-weight:700;
      margin-bottom:10px;
      line-height:1.4;
      text-align:center;
    }
    .route-time{
      font-size:16px;
      color:var(--text);
      display:flex;
      gap:20px;
      font-weight:600;
      margin-bottom:12px;
      justify-content:center;
    }
    .route-time span{
      display:flex;
      align-items:center;
      gap:4px;
    }
    .weather-row{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .location-name{
      font-size:20px;
      font-weight:700;
      color:var(--primary);
      white-space:nowrap;
    }
    .weather-items{
      display:flex;
      gap:4px;
      flex:1;
      justify-content:center;
      align-items:center;
    }
    .weather-arrow{
      color:var(--muted);
      font-size:18px;
      font-weight:900;
    }
    .weather-item{
      text-align:center;
      font-size:11px;
      color:var(--text);
      padding:8px 6px;
      background:rgba(16,22,36,.25);
      border-radius:8px;
      min-width:60px;
    }
    .weather-time{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
      margin-bottom:2px;
    }
    .weather-icon{font-size:20px;margin:2px 0}
    .weather-temp{font-weight:700;font-size:13px}
    .weather-rain{color:var(--accent);font-size:11px;font-weight:700}

    .right-buttons{
      position:absolute;
      right:10px;
      top: calc(50% - 200px); /* 修正: 固定値359pxをcalcで動的に調整（ボタン群の高さを考慮、中央寄せ）。デザイン崩れなし */
      z-index:470;
      display:flex;
      flex-direction:column;
      gap:10px;
      pointer-events:none;
    }
    .right-btn{
      width:65px;
      height:65px;
      background:rgba(16,22,36,.25);
      border:1px solid rgba(255,255,255,.3);
      border-radius:10px;
      color:#fff;
      font-size:11px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-weight:700;
      gap:2px;
      pointer-events:auto;
      box-shadow:0 8px 32px rgba(0,0,0,.4);
      backdrop-filter:blur(24px) saturate(200%);
      -webkit-backdrop-filter:blur(24px) saturate(200%);
    }
    .right-btn.primary{background:rgba(95,177,255,.6);border:1px solid rgba(255,255,255,.4);color:#000;backdrop-filter:blur(24px) saturate(200%);-webkit-backdrop-filter:blur(24px) saturate(200%);}
    .right-btn.ok{background:rgba(37,208,122,.6);border:1px solid rgba(255,255,255,.4);color:#000;backdrop-filter:blur(24px) saturate(200%);-webkit-backdrop-filter:blur(24px) saturate(200%);}
    .right-btn.danger{background:rgba(255,101,101,.6);border:1px solid rgba(255,255,255,.4);color:#fff;backdrop-filter:blur(24px) saturate(200%);-webkit-backdrop-filter:blur(24px) saturate(200%);}
    .right-btn.danger:disabled{opacity:1;background:rgba(255,101,101,.6);cursor:not-allowed;color:#fff;backdrop-filter:blur(24px) saturate(200%);-webkit-backdrop-filter:blur(24px) saturate(200%);}
    .right-btn.accent{background:rgba(100,210,255,.6);border:1px solid rgba(255,255,255,.4);color:#000;backdrop-filter:blur(24px) saturate(200%);-webkit-backdrop-filter:blur(24px) saturate(200%);}
    .right-btn.warning{background:rgba(255,165,0,.6);border:1px solid rgba(255,255,255,.4);color:#000;backdrop-filter:blur(24px) saturate(200%);-webkit-backdrop-filter:blur(24px) saturate(200%);}

    .map-controls{
      position:fixed;
      right:97px;
      bottom:25px;
      z-index:450;
      display:none;
      gap:8px;
    }
    .map-controls.show{
      display:flex !important; /* 修正: !importantを追加（潜在的な優先度問題対策） */
      flex-direction:column;
      align-items:center;
    }
    .map-control-row{
      display:flex;
      gap:8px;
    }
    .map-control-btn{
      width:65px;
      height:65px;
      background:rgba(16,22,36,.85);
      border:1px solid var(--stroke);
      border-radius:10px;
      color:#fff;
      font-size:20px;
      cursor:pointer;
      font-weight:700;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      box-shadow:0 2px 6px rgba(0,0,0,.3);
      backdrop-filter:blur(6px);
    }
    .map-control-btn:active{
      background:var(--primary);
    }

    .results-panel{
      position:absolute;
      left:10px;
      right:10px;
      bottom:10px;
      max-height:60vh;
      overflow-y:auto;
      background:var(--glass);
      border:1px solid var(--stroke);
      border-radius:12px;
      padding:10px;
      z-index:510;
      display:none;
    }
    .result-item{
      padding:10px;
      border-bottom:1px solid var(--stroke);
      cursor:pointer;
    }
    .result-item:hover{background:rgba(95,177,255,.2)}
    .result-close{text-align:center;padding:8px;color:var(--primary);cursor:pointer}

    .saved-points-panel{
      position:absolute;
      left:10px;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      max-height:70vh;
      overflow-y:auto;
      background:var(--glass);
      border:1px solid var(--stroke);
      border-radius:12px;
      padding:10px;
      z-index:510;
      display:none;
    }
    .saved-point-item{
      padding:12px;
      background:var(--glass-strong);
      border:1px solid var(--stroke);
      border-radius:8px;
      margin-bottom:8px;
      cursor:pointer;
      font-size:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .saved-point-item:hover{background:rgba(95,177,255,.3)}
    .saved-point-name{flex:1}
    .saved-point-actions{display:flex;gap:6px}
    .saved-point-btn{
      padding:4px 10px;
      background:var(--primary);
      border-radius:6px;
      font-size:12px;
      cursor:pointer;
      color:#000;
      font-weight:700;
    }
    .saved-point-btn.delete{background:var(--danger);color:#fff}
    .saved-close{text-align:center;padding:10px;color:var(--primary);cursor:pointer;font-weight:700}

    .error-banner{
      position:absolute;
      left:10px;
      right:10px;
      bottom:10px;
      background:var(--danger);
      color:#fff;
      border-radius:10px;
      padding:10px;
      text-align:center;
      z-index:999;
    }
    .success-banner{
      position:absolute;
      left:10px;
      right:10px;
      bottom:10px;
      background:#7ed321;
      color:#000;
      border-radius:10px;
      padding:10px;
      text-align:center;
      z-index:999;
      font-weight:700;
    }
    .hidden{display:none}
    .loading-screen{
      position:fixed;
      inset:0;
      background:#0e1a2d;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1000;
      transition:opacity 0.3s;
    }
    .loading-screen.hide{opacity:0;pointer-events:none}

    .gm-control-active.gm-fullscreen-control {
      display: none !important;
    }
    .gm-svpc,
    .gm-style .gm-style-cc {
      display: none !important;
    }

    .gm-style-iw,
    .gm-style-iw-c,
    .gm-style-iw-d,
    .gm-style-iw-t::after,
    div[aria-label*="付近"],
    div[aria-label*="美馬郡"],
    div[title*="付近"] {
      display: none !important;
      opacity: 0 !important;
      visibility: hidden !important;
    }

    @keyframes marquee {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
  </style>
</head>
<body>
  <!-- HTML構造そのまま -->
  <div class="app">
    <div id="map"></div>
    
    <div id="infoPanel" class="info-panel">
      <!-- 元のコンテンツそのまま -->
    </div>
    
    <div id="mapControls" class="map-controls">
      <!-- 元のコンテンツそのまま -->
    </div>
    
    <div id="panelToggle" class="panel-toggle" onclick="togglePanel()"><span id="btnOpenPanel">操作パネルを表示</span></div>
    
    <div id="controlPanel" class="control-panel hidden">
      <!-- 元のコンテンツそのまま -->
    </div>
    
    <div id="resultsPanel" class="results-panel">
      <!-- 元のコンテンツそのまま -->
    </div>
    
    <div id="routeSelectModal" style="display:none;<!-- 元のスタイルそのまま -->">
      <!-- 元のコンテンツそのまま -->
    </div>
    
    <div id="searchTypeModal" style="display:none;<!-- 元のスタイルそのまま -->">
      <!-- 元のコンテンツそのまま -->
    </div>
    
    <div id="savedPointsPanel" class="saved-points-panel">
      <!-- 元のコンテンツそのまま -->
    </div>
    
    <div id="error" class="error-banner hidden"></div>
    <div id="success" class="success-banner hidden"></div>
    
    <div id="rightButtons" class="right-buttons">
      <!-- 元のボタン群そのまま -->
    </div>
    
    <div id="loading" class="loading-screen">
      <!-- 元のコンテンツそのまま -->
    </div>
  </div>
  
  <script>
    // JSコードそのまま（前の修正を含む）。追加デバッグ: initMapでログ出力
    "use strict";
    let map,directionsService,directionsRenderer,currentMarker=null,destMarker=null,watchId=null,isNavigating=!1,currentLocation=null,savedPoints=[],selectingMapPoint=!1,stopAnnounced=!1,currentLang="ja";
    let placesService = null;

    // ... (元のスクリプトそのまま)

    function initMap(){
      // ... (元のコード)
      setTimeout(()=>{
        // ... (元のコード)
        debugLog("UI elements shown: infoPanel and panelToggle"); // 修正: 表示確認ログ追加（コンソールのみ、デザイン影響なし）
      },100);
      // ... 
    }

    // ... (残りの関数そのまま)
  </script>
  <script>
    const script=document.createElement('script');
    script.src=`https://maps.googleapis.com/maps/api/js?key=AIzaSyBzojEE2142O8dWPd7gmcAj-FyWumYyFy4&libraries=places`;
    script.async=true;
    script.defer=true;
    document.body.appendChild(script);
  </script>
</body>
</html>