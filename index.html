<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1" />
<title>WalkNav â€“ rollback</title>
<style>
  /* ==== åœ°å›³ã¯å¸¸ã«100%ç¢ºä¿ï¼ˆç™½åœ°å›³é˜²æ­¢ï¼‰ ==== */
  html, body { height:100%; margin:0; padding:0; background:#0c1622; }
  #map { position:fixed; inset:0; }

  /* ==== æ–¹ä½è¨ˆ & åˆ‡æ›¿ãƒœã‚¿ãƒ³ï¼ˆå·¦ä¸Šå›ºå®šï¼‰ ==== */
  .compass-wrap{ position:fixed; left:14px; top:14px; z-index:20; display:flex; flex-direction:column; gap:10px; }
  .compass{ width:94px;height:94px;border-radius:50%; background:#26323f; box-shadow:0 6px 18px rgba(0,0,0,.35) inset, 0 1px 8px rgba(0,0,0,.25); position:relative; }
  .compass:before{ content:"N"; position:absolute; top:8px; left:50%; transform:translateX(-50%); font:bold 16px/1 system-ui; color:#ffd65a; }
  .needle{ position:absolute; left:50%; top:50%; width:64px; height:6px; background:#ff5a5a; border-radius:3px; transform-origin:0% 50%; transform:translate(0,-50%) rotate(0deg); }
  .row{ display:flex; gap:10px; }
  .btn{ -webkit-tap-highlight-color:transparent; user-select:none; cursor:pointer; border:none; border-radius:14px; padding:10px 16px; font:600 14px/1.1 system-ui; }
  .btn-ghost{ background:#1e2a36; color:#fff; box-shadow:0 6px 18px rgba(0,0,0,.25); }
  .btn-green{ background:#23b26b; color:#fff; }
  .btn-red{ background:#ff6767; color:#fff; }
  .btn-blue{ background:#6bb2ff; color:#0b1a2b; }
  .chip{ padding:10px 14px; border-radius:16px; background:#111a24cc; color:#dfe9f6; }

  /* ==== ãƒ‘ãƒãƒ«ï¼ˆä¸‹ä»˜ãï¼ä¸‹æ–¹å‘ã«åç´ï¼‰ ==== */
  .panel{ position:fixed; left:14px; right:14px; bottom:14px; z-index:30;
          background:rgba(22,33,46,.86); color:#eaf2ff; border-radius:18px;
          backdrop-filter: blur(8px); box-shadow:0 12px 32px rgba(0,0,0,.35);
          padding:16px; transition:transform .28s ease; }
  .panel.hide{ transform:translateY(calc(100% + 20px)); }
  .panel h3{ margin:10px 0; font:700 18px/1.2 system-ui; }
  .field{ background:#0f1a26; border-radius:12px; padding:14px; color:#cfe0f6; box-shadow:inset 0 0 0 1px rgba(255,255,255,.06); }
  .grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .grid-3{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
  .row-split{ display:flex; gap:10px; align-items:center; }
  .help{ color:#9fb4cc; font:600 12px/1.2 system-ui; opacity:.9; }

  /* ãƒ‘ãƒãƒ«å‘¼ã³å‡ºã—ã‚¿ãƒ–ï¼ˆç”»é¢åº•ä¸­å¤®ï¼‰ */
  .tab{ position:fixed; left:50%; transform:translateX(-50%); bottom:18px; z-index:25;
        background:#0e1722e6; color:#fff; padding:12px 18px; border-radius:18px;
        box-shadow:0 8px 24px rgba(0,0,0,.35); }
  .tab.hide{ display:none; }

  /* ä»•æ§˜ï¼šãƒ‘ãƒãƒ«è¡¨ç¤ºä¸­ã¯åœ°å›³UIã‚’éš ã™ */
  .ui-hidden{ display:none !important; }
</style>
</head>
<body>

<div id="map"></div>

<!-- å·¦ä¸Šï¼šæ–¹ä½è¨ˆ + ãƒãƒ¼ã‚¹/ãƒ˜ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆãƒ‘ãƒãƒ«è¡¨ç¤ºæ™‚ã¯è‡ªå‹•ã§æ¶ˆãˆã‚‹ï¼‰ -->
<div id="compassWrap" class="compass-wrap">
  <div class="compass"><div id="needle" class="needle"></div></div>
  <div class="row">
    <button id="northBtn" class="btn btn-ghost">ãƒãƒ¼ã‚¹ã‚¢ãƒƒãƒ—</button>
    <button id="headBtn" class="btn btn-ghost">ãƒ˜ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒƒãƒ—</button>
  </div>
</div>

<!-- ç”»é¢åº•ä¸­å¤®ï¼šãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º -->
<button id="panelTab" class="tab">â–² ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º</button>

<!-- ä¸‹ä»˜ãæ“ä½œãƒ‘ãƒãƒ«ï¼ˆè¡¨ç¤ºä¸­ã¯æ–¹ä½è¨ˆãƒ»ã‚¿ãƒ–ã‚’éš ã™ï¼šJSã§åˆ¶å¾¡ï¼‰ -->
<div id="panel" class="panel">
  <div class="row-split">
    <div class="chip">åº—èˆ—åãƒ»ä½æ‰€ãƒ»é›»è©±ç•ªå·ã§æ¤œç´¢</div>
    <button id="voiceBtn" class="btn btn-green">ğŸ¤ éŸ³å£°</button>
  </div>

  <div class="grid" style="margin-top:12px;">
    <button id="searchBtn" class="btn btn-blue">æ¤œç´¢</button>
    <button id="clearBtn"  class="btn btn-ghost">å±¥æ­´ã‚’ã‚¯ãƒªã‚¢</button>
  </div>

  <div class="grid-3" style="margin-top:10px;">
    <button class="btn btn-blue">æœ€çŸ­Ai</button>
    <button class="btn btn-ghost">æ¥½ãƒãƒ³Ai</button>
    <button class="btn btn-ghost">ãŠæ•£æ­©Ai</button>
  </div>

  <div class="row-split" style="margin-top:10px;">
    <span class="chip">â–¶ è¨€èª / Language</span>
  </div>

  <h3>é–‹å§‹åœ°ç‚¹</h3>
  <div class="grid">
    <div class="field" id="curLng">ç¾åœ¨åœ°çµŒåº¦</div>
    <div class="field" id="curLat">ç¾åœ¨åœ°ç·¯åº¦</div>
  </div>

  <h3 style="margin-top:12px;">ç›®çš„åœ°ç‚¹</h3>
  <div class="grid">
    <div class="field">ç›®çš„åœ°çµŒåº¦</div>
    <div class="field">ç›®çš„åœ°ç·¯åº¦</div>
  </div>

  <div class="grid" style="margin-top:12px;">
    <div class="field">(æœªé¸æŠ)</div>
    <button id="saveHereBtn" class="btn btn-green">ç¾åœ¨åœ°ã‚’ä¿å­˜</button>
  </div>

  <div class="grid" style="margin-top:12px;">
    <button class="btn btn-blue">ç›®çš„åœ°ã«è¨­å®š</button>
    <button class="btn btn-red">å‰Šé™¤</button>
  </div>

  <div class="grid" style="margin-top:12px;">
    <button id="closePanelBtn" class="btn btn-blue">æ“ä½œãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹</button>
  </div>

  <div class="help" style="margin-top:8px;">æº–å‚™å®Œäº†ã€‚ç›®çš„åœ°ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</div>
</div>

<script>
  /* =========================================================
     Rollbackç‰ˆï¼šä½™è¨ˆãªæ‰‹ã¯åŠ ãˆãšã€ä»¥å‰ã®æ§‹æˆã«æˆ»ã™ã ã‘
  ========================================================== */

  // ä»•æ§˜ï¼šãƒ‘ãƒãƒ«è¡¨ç¤º/åç´ã«å¿œã˜ã¦UIã‚’å‡ºã—åˆ†ã‘
  const panel = document.getElementById('panel');
  const tab   = document.getElementById('panelTab');
  const compassWrap = document.getElementById('compassWrap');
  function showPanel() {
    panel.classList.remove('hide');
    tab.classList.add('hide');          // ãƒ‘ãƒãƒ«è¡¨ç¤ºä¸­ã¯ã‚¿ãƒ–ã‚’å‡ºã•ãªã„
    compassWrap.classList.add('ui-hidden'); // ãƒ‘ãƒãƒ«è¡¨ç¤ºä¸­ã¯æ–¹ä½è¨ˆ/åˆ‡æ›¿ã‚’éš ã™
  }
  function hidePanel() {
    panel.classList.add('hide');
    tab.classList.remove('hide');       // åç´ä¸­ã®ã¿ã‚¿ãƒ–ã‚’å‡ºã™
    compassWrap.classList.remove('ui-hidden'); // åç´ä¸­ã¯æ–¹ä½è¨ˆ/åˆ‡æ›¿ã‚’å‡ºã™
  }
  document.getElementById('closePanelBtn').addEventListener('click', hidePanel);
  tab.addEventListener('click', showPanel);
  // åˆæœŸçŠ¶æ…‹ï¼šä»•æ§˜ã«åˆã‚ã›ã¦ã€Œè¡¨ç¤ºã€ã‹ã‚‰é–‹å§‹ï¼ˆå¿…è¦ãªã‚‰ hidePanel() ã«å¤‰æ›´ï¼‰
  showPanel();

  // éŸ³å£°ãƒœã‚¿ãƒ³ã®è‰²ï¼ˆå¾…æ©Ÿ=ç·‘ï¼éŒ²éŸ³=èµ¤ï¼‰ã ã‘ã‚’å¾©å…ƒ
  const voiceBtn = document.getElementById('voiceBtn');
  let listening = false;
  voiceBtn.addEventListener('click', () => {
    listening = !listening;
    voiceBtn.className = 'btn ' + (listening ? 'btn-red' : 'btn-green');
    voiceBtn.textContent = listening ? 'ğŸ¤ éŒ²éŸ³ä¸­' : 'ğŸ¤ éŸ³å£°';
  });

  // ç°¡æ˜“ã‚³ãƒ³ãƒ‘ã‚¹è¡¨ç¤ºï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šæŒ™å‹•ã¯ä»¥å‰ã¨åŒç­‰ã®æœ€å°ï¼‰
  const needle = document.getElementById('needle');
  let headingMode = 'north'; // 'north' | 'heading'
  document.getElementById('northBtn').addEventListener('click', ()=> headingMode='north');
  document.getElementById('headBtn').addEventListener('click',  ()=> headingMode='heading');
  if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
    // iOSç³»ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã«è¨±å¯ã‚’æ±‚ã‚ã‚‹ï¼ˆã“ã“ã§ã¯ãƒœã‚¿ãƒ³ã«å‰²å½“ã¦ãªã„ï¼ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
  } else {
    window.addEventListener('deviceorientation', (e)=>{
      const deg = (e.webkitCompassHeading!=null) ? e.webkitCompassHeading : (360 - (e.alpha||0));
      needle.style.transform = `translate(0,-50%) rotate(${deg}deg)`;
    }, true);
  }

  // ==== Google Maps åˆæœŸåŒ–ï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šcallback=initMap ã®ã¿ï¼‰ ====
  let map;
  function initMap() {  // â† ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°å®£è¨€ã€‚window.* ä»£å…¥ã¯ã—ãªã„
    map = new google.maps.Map(document.getElementById('map'), {
      center:{lat:34.0408, lng:134.0641}, zoom:16,
      disableDefaultUI:true, clickableIcons:true, mapTypeControl:false
    });
    // ç¾åœ¨åœ°ã«ç§»å‹•ï¼ˆå¤±æ•—ã—ã¦ã‚‚ãã®ã¾ã¾ï¼‰
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => map.setCenter({lat:pos.coords.latitude, lng:pos.coords.longitude}),
        ()=>{}
      );
    }
  }
</script>
<!-- â˜…ã“ã“ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼šé…å¸ƒæ¸ˆã¿â€œãƒ–ãƒ©ã‚¦ã‚¶ç”¨â€APIã‚­ãƒ¼ -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_BROWSER_API_KEY_HERE&libraries=places&callback=initMap" async defer></script>
</body>
</html>