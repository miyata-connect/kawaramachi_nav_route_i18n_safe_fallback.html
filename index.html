<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WalkNav v5</title>
  <style>
:root{
  --glass: rgba(20,28,44,.70);
  --glass-strong: rgba(16,22,36,.85);
  --stroke: rgba(255,255,255,.14);
  --text:#eaf2ff;
  --muted:#a7b8ce;
  --primary:#5fb1ff;
  --ok:#25d07a;
  --danger:#ff6565;
  --accent:#64d2ff;
}
html,body{height:100%;margin:0;background:#0a1321;color:var(--text);font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif}
*{box-sizing:border-box}
.app{position:relative;height:100dvh;overflow:hidden}
#map{position:absolute;inset:0;display:none}

/* ローディング画面 */
#loading{
  position:absolute;inset:0;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:#0a1321;z-index:200;
  color:var(--text);font-size:15px;text-align:center;line-height:1.7;
}

/* 波紋マーカー */
.ripple-pin{
  position:relative;width:28px;height:28px;border-radius:50%;background:#ff4d4d;box-shadow:0 0 0 2px rgba(255,255,255,.9) inset;
}
.ripple-pin::before,.ripple-pin::after{
  content:"";position:absolute;inset:-8px;border-radius:50%;border:2px solid rgba(255,77,77,.55);animation:ripple 1.8s infinite ease-out
}
.ripple-pin::after{inset:-16px;animation-delay:.6s;opacity:.6}
@keyframes ripple{0%{transform:scale(.5);opacity:.9}100%{transform:scale(1.6);opacity:0}}

.panel{
  position:absolute;left:10px;right:10px;top:10px;z-index:25;
  background:var(--glass);border:1px solid var(--stroke);backdrop-filter:blur(12px);
  border-radius:22px;padding:14px 14px 10px;
}
.panel h2{text-align:center;margin:0 0 10px;font-size:18px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-bottom:10px}
.input{flex:1;background:var(--glass-strong);color:var(--text);border:1px solid var(--stroke);border-radius:14px;padding:10px;font-size:14px;width:100%}
.btn{
  background:var(--glass-strong);color:var(--text);border:1px solid var(--stroke);border-radius:12px;padding:10px 16px;cursor:pointer;min-width:100px;height:44px
}
.btn-primary{background:var(--primary);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.km-btn{min-width:90px}
.fab-col{position:absolute;right:12px;bottom:100px;z-index:60;display:flex;flex-direction:column;gap:12px}
.fab{width:92px;height:56px;display:flex;align-items:center;justify-content:center;background:var(--glass-strong);border:1px solid var(--stroke);border-radius:18px;color:var(--text);backdrop-filter:blur(12px);cursor:pointer}
.toast{position:absolute;top:20px;left:50%;transform:translateX(-50%);background:var(--glass-strong);border:1px solid var(--stroke);color:var(--text);padding:10px 16px;border-radius:12px;backdrop-filter:blur(10px);z-index:70;display:none}
.meta{text-align:center;font-size:13px;color:var(--muted);margin:6px 0 2px}
  </style>
</head>
<body>
  <div class="app">
    <div id="loading">
      <p>現在地取得中です。<br>ご迷惑をお掛けします。<br>現在地表示まで30秒程お待ちください。</p>
      <button id="retryBtn" style="display:none;margin-top:12px;padding:8px 16px;border-radius:10px;background:var(--primary);color:#fff;border:none;">再試行</button>
    </div>

    <div id="map"></div>

    <div class="panel" id="panel">
      <h2>近くを検索（10km / 5件）</h2>
      <div class="row">
        <button class="btn km-btn" data-km="10">10km</button>
        <button class="btn km-btn" data-km="20">20km</button>
        <button class="btn km-btn" data-km="30">30km</button>
      </div>
      <div class="row"><input id="query" class="input" placeholder="店舗名・電話番号・カテゴリ・住所・座標・施設名"></div>
      <div class="row">
        <button id="btn-voice" class="btn">音声検索</button>
        <button id="btn-text" class="btn btn-primary">入力検索</button>
        <button id="btn-reset" class="btn btn-danger">リセット</button>
      </div>
      <div class="row">
        <label><input type="checkbox" id="anywhere"> 任意の場所を検索</label>
        <label><input type="checkbox" id="openNow"> 現在営業中</label>
        <label><input type="checkbox" id="review"> レビュー順</label>
      </div>
      <div class="row">
        <button id="btn-save-current" class="btn">現在地点登録</button>
        <button id="btn-edit-saved" class="btn">登録地点修正</button>
      </div>
      <p id="coord" class="meta">現在地：緯度: -- / 経度: --</p>
    </div>

    <div class="fab-col">
      <div id="fab-current" class="fab">現在地</div>
      <div id="fab-pause" class="fab">一時停止</div>
      <div id="fab-reroute" class="fab">リルート</div>
    </div>

    <div id="toast" class="toast"></div>
  </div>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzojEE2142O8dWPd7gmcAj-FyWumYyFy4&v=weekly&libraries=marker" defer></script>

  <script>
const $=s=>document.querySelector(s);
const toast=(m,d=2500)=>{const el=$("#toast");el.textContent=m;el.style.display="block";setTimeout(()=>el.style.display="none",d)};
let map,currentMarker=null,currentPos=null;const PANEL_OFFSET_PX=150;
function rippleMarker(pos){const el=document.createElement("div");el.className="ripple-pin";return new google.maps.marker.AdvancedMarkerElement({map,position:pos,content:el})}
function showMarker(lat,lng){if(currentMarker)currentMarker.map=null;currentMarker=rippleMarker({lat,lng});$("#coord").textContent=`現在地：緯度: ${lat.toFixed(6)} / 経度: ${lng.toFixed(6)}`;map.setZoom(17);map.setCenter({lat,lng});setTimeout(()=>map.panBy(0,PANEL_OFFSET_PX),200)}
function getPos(t=30000){return new Promise((ok,ng)=>{let done=false;const tm=setTimeout(()=>{if(done)return;done=true;ng("timeout")},t);navigator.geolocation.getCurrentPosition(p=>{if(done)return;done=true;clearTimeout(tm);ok(p)},e=>{if(done)return;done=true;clearTimeout(tm);ng(e)}, {enableHighAccuracy:true,timeout:t})})}
async function init(){try{const p=await getPos(30000);const {latitude,longitude}=p.coords;$("#loading").style.display="none";$("#map").style.display="block";map=new google.maps.Map($("#map"),{center:{lat:latitude,lng:longitude},zoom:17,mapId:"DEMO_MAP"});showMarker(latitude,longitude);toast("現在地を取得しました")}catch(e){$("#loading").innerHTML=`<p>現在地を取得出来ませんでした。<br>屋外や空の開けた場所でお試しください。</p>`;$("#retryBtn").style.display="block";$("#retryBtn").onclick=()=>location.reload()}}
window.addEventListener("load",()=>{const id=setInterval(()=>{if(window.google&&google.maps){clearInterval(id);init()}},80)});
  </script>
</body>
</html>