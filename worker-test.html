<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Workeræ¥ç¶šãƒ†ã‚¹ãƒˆ</title>
  <style>
    body{font-family:sans-serif;padding:20px;background:#0a1321;color:#fff}
    .box{background:#1a2332;border:1px solid #333;border-radius:8px;padding:15px;margin:10px 0}
    button{background:#5fb1ff;color:#fff;border:none;border-radius:8px;padding:12px 20px;font-size:16px;cursor:pointer;width:100%}
    pre{background:#000;color:#0f0;padding:10px;border-radius:4px;overflow-x:auto;font-size:12px}
    .error{color:#ff6565}
    .success{color:#25d07a}
  </style>
</head>
<body>
  <h1>ğŸ”§ Workeræ¥ç¶šãƒ†ã‚¹ãƒˆ</h1>
  
  <div class="box">
    <h3>1. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª</h3>
    <button onclick="testEndpoint()">ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆ</button>
    <pre id="endpointResult">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</pre>
  </div>
  
  <div class="box">
    <h3>2. Places API ãƒ†ã‚¹ãƒˆ</h3>
    <button onclick="testPlaces()">Places APIã‚’ãƒ†ã‚¹ãƒˆ</button>
    <pre id="placesResult">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</pre>
  </div>
  
  <div class="box">
    <h3>3. CORSç¢ºèª</h3>
    <button onclick="testCORS()">CORSã‚’ãƒ†ã‚¹ãƒˆ</button>
    <pre id="corsResult">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</pre>
  </div>

  <script>
const ENDPOINT = "https://ors-proxy.miyata-connect-jp.workers.dev/v1/places";

async function testEndpoint() {
  const result = document.getElementById("endpointResult");
  result.textContent = "ãƒ†ã‚¹ãƒˆä¸­...";
  
  try {
    const res = await fetch(ENDPOINT, {
      method: "GET"
    });
    
    result.className = res.ok ? "success" : "error";
    result.textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${res.status} ${res.statusText}\n`;
    
    const text = await res.text();
    result.textContent += `ãƒ¬ã‚¹ãƒãƒ³ã‚¹:\n${text.substring(0, 500)}`;
  } catch(e) {
    result.className = "error";
    result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${e.message}`;
  }
}

async function testPlaces() {
  const result = document.getElementById("placesResult");
  result.textContent = "ãƒ†ã‚¹ãƒˆä¸­...";
  
  try {
    const res = await fetch(ENDPOINT, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Goog-FieldMask": "places.displayName,places.location"
      },
      body: JSON.stringify({
        textQuery: "ã‚³ãƒ³ãƒ“ãƒ‹",
        locationBias: {
          circle: {
            center: { latitude: 35.681236, longitude: 139.767125 },
            radius: 5000
          }
        },
        maxResultCount: 1
      })
    });
    
    result.className = res.ok ? "success" : "error";
    result.textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${res.status} ${res.statusText}\n\n`;
    
    const data = await res.json();
    result.textContent += JSON.stringify(data, null, 2);
  } catch(e) {
    result.className = "error";
    result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${e.message}\n\nè©³ç´°:\n${e.stack}`;
  }
}

async function testCORS() {
  const result = document.getElementById("corsResult");
  result.textContent = "ãƒ†ã‚¹ãƒˆä¸­...";
  
  try {
    const res = await fetch(ENDPOINT, {
      method: "OPTIONS"
    });
    
    const headers = {};
    res.headers.forEach((v, k) => headers[k] = v);
    
    result.className = "success";
    result.textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${res.status}\n\n`;
    result.textContent += "CORSãƒ˜ãƒƒãƒ€ãƒ¼:\n";
    result.textContent += JSON.stringify(headers, null, 2);
    
    if(!headers["access-control-allow-origin"]) {
      result.className = "error";
      result.textContent += "\n\nâŒ CORSè¨­å®šãªã—ï¼";
    }
  } catch(e) {
    result.className = "error";
    result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${e.message}`;
  }
}
  </script>
</body>
</html>