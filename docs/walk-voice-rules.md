# Walk Voice & Routing Rules Documentation (v1)

## Overview
このドキュメントは、Walk-Navi の音声案内およびルーティング動作に関するルール、運用基準、閾値を定義します。  
対象：Shortest / Safest / Accessible の 3 モード。

---

## Voice Rules（音声案内ルール）

### 共通方針
- すべてのモードで **強制リルートは禁止**。  
  必ずユーザーの意思確認を先行。
- 天候や安全情報を検出した場合は、**確認ダイアログと音声での確認**を行う。

### 基本音声例
| 状況 | 音声出力例 |
|------|-------------|
| 雨雲接近 | 「雨雲の接近が確認できました。天候回避ルートに切り替えます。よろしいですか？」 |
| ユーザー承認後 | 「只今より、天候回避ルートでご案内します。」 |
| 天候ボタン操作時 | 「天候回避ボタンを選択されました。只今より、天候回避ルートでご案内します。」 |

### 案内テンプレート（構文）
`（道路種別）（路線番号）号線を（方位）方向へ（距離）メートル進んでください。`
例：  
「県道33号線を東方向へ150メートル進んでください。」

---

## Routing Modes（ルートモード定義）

### Shortest（最短）
- 最短距離優先。ただし安全帯（歩道・横断歩道等）は必須。
- 路肩通行は「歩道が存在しない場合のみ」許可。
- 夜間は極端な暗所（照度しきい値未満）を除外。
- 自動リルートは行わず、必ず確認ダイアログを出す。

### Safest（安全）
- 距離よりも安全性を優先。
- 勾配 8% 以上の坂道は回避（30m 以上の連続区間）。
- 階段は回避推奨。
- 夜間は照度が高い経路を強く優先。
- 自動リルートなし。確認後に切り替え。

### Accessible（バリアフリー）
- 車椅子・ベビーカー対応。
- 勾配 5% 以下、階段・段差なし。
- エレベータ／スロープがない立体交差は不許可。
- 照度優先。自動リルート禁止、必ず確認あり。

---

## Weather & Environmental Conditions（天候・環境条件）

### 夏季判定
- 期間：6 月 1 日〜10 月 31 日  
- トリガ温度：28°C 以上  
- 対応：日陰・アーケード・建物沿いを優先、水分補給通知。

### 雨・雷
- 滑りやすい路面を避け、屋根付き経路を優先。
- 雷時は高架下・開けた橋上を避ける。

### 強風・降雪
- 橋梁・海沿いを避け、建物沿い優先。
- 積雪時は勾配制約を厳格化。

### 周辺警戒（事件・事故）
- 半径 5km 圏内に規制情報がある場合、通知のみ（自動リルートなし）。
- 音声：「周辺で規制情報が検出されました。迂回ルートに切り替えます。よろしいですか？」

---

## Ops Thresholds（運用値・判定条件）

### 1) 安全帯（通行可否の基本）

**常時「許可」**  
- 歩道（Sidewalk）  
- 横断歩道（Zebra / Signalized）  
- 歩道橋・ペデストリアンデッキ（Overpass / Footbridge）  
- 地下道（Underpass）  
- 踏切（Railway Crossing）

**条件付き「許可」**  
- 路肩（Shoulder / Roadside）：歩道が存在しない区間のみ許可。  
  高速道路・見通し不良・幅員不足は Safest / Accessible では回避推奨。

**原則「不許可」**  
- 斜め横断・無理な横断  
- 高速道路・トンネル歩道なし区間

> 照度に関して：Shortest は極端な暗所を除外、Safest / Accessible は照度の高い通行帯を優先。

---

### 2) モード別詳細ルール

#### Shortest（最短）
- 最短距離を優先しつつ安全帯を遵守。
- 路肩許可：歩道が無い場合のみ。
- 夜間暗所回避。
- 天候トリガー発生時：自動リルート禁止、要確認。

#### Safest（安全）
- 坂 ≥ 8%（30m 以上）を回避。
- 階段回避推奨。
- 夜間照度優先。
- 天候トリガー：要確認後に切替。

#### Accessible（バリアフリー）
- 勾配 ≤ 5%、段差・階段不可。
- エレベータ・スロープ必須。
- 天候トリガー：要確認後切替。

---

### 3) 天候・季節・警戒情報

**起動時選択**
- 「選択したルートを優先」 or 「天候回避ルートを優先」。

**天候ボタン操作**
- 「天候回避ボタンを選択されました。只今より、天候回避ルートでご案内します。」

**夏季運用**
- 期間：6/1〜10/31、気温 28°C 以上。  
- 対応：日陰優先・休憩地点提案・水分補給案内。

**降雨・雷**
- 滑りやすい区間を避け、屋根付き経路優先。

**強風・降雪**
- 橋・海沿いを避け、建物沿い優先。

**事件・事故**
- 半径 5km 内で通知、必ず確認後切替。

---

### 4) 音声案内共通ルール

- 強制リルート禁止、常にユーザー承認を先行。  
- 音声例：  
  - 雨雲検知：「雨雲の接近が確認できました。天候回避ルートに切り替えます。よろしいですか？」  
  - ボタン操作：「天候回避ボタンを選択されました。只今より、天候回避ルートでご案内します。」

---

### 5) 実装・テスト対応メモ

| モード | 条件概要 |
|--------|-----------|
| Shortest | 安全帯通行のみ、暗所除外、確認あり |
| Safest | 勾配 ≥ 8%、階段回避、照度優先 |
| Accessible | 勾配 ≤ 5%、階段不可、エレベータ必須 |
| 全モード共通 | 自動リルート禁止、ダイアログ確認必須 |

---

**最終更新**：v1.0（2025-10-20）  
**メンテナー**：miyata-connect / walk-nav Docs Team
